- hosts: mac
  tasks:
    # Adding a tap for https://github.com/Homebrew/homebrew-cask-versions
  - name: cask-versions tap
    homebrew_tap:
      name: homebrew/cask-versions
  - name: spotify tap
    homebrew_tap:
      name: spotify/sptaps
      url: git@ghe.spotify.net:shared/homebrew-spotify.git
  - name: homebrew
    homebrew:
      name: "{{item}}"
      state: latest
    with_items:
      - bash
      - checkstyle
      - dos2unix
      - git
      - gnupg
      - google-java-format
      - gradle
      - htop
      - maven
      - npm
      - pipenv
      - pmd
      - protobuf
      - pstree
      - reattach-to-user-namespace
      - rust
      - tmux
      - tree
      - unrar
      - watch
      - wget
      - spotify/sptaps/hmtools
  - name: macvim
    homebrew:
      name: macvim
      state: latest
      install_options: with-override-system-vim
  - name: cask
    homebrew_cask:
      name: "{{item}}"
      state: latest
    with_items:
      - 1password6
      - airflow
      - alfred
      - android-studio
      - daisydisk
      - docker
      - dropbox
      - google-chrome-canary
      - google-backup-and-sync
      - intellij-idea-ce
      - iterm2-beta
      - java
      - java8
      - pomello
      - slack
      - slate
      - spotify
      - steam
      - transmission
      - trello
      - vlc
      - whatsapp
      - wireshark
  - name: npm
    npm:
      name: "{{item}}"
      state: latest
      global: yes
    with_items:
      - git-open
  - name: vundle
    git:
      repo: https://github.com/VundleVim/Vundle.vim.git
      dest: ~/.vim/bundle/Vundle.vim
      # run vim +PluginInstall +qall
  - name: TPM
    git:
      repo: https://github.com/tmux-plugins/tpm
      dest: ~/.tmux/plugins/tpm
  - name: dotfiles checkout
    shell: 'git init && git remote add origin git@github.com:protocol7/dotfiles.git && git fetch && git reset origin/master && git checkout -t origin/master'
    args:
      chdir: ~/
      creates: ~/.git/
  - name: src dir
    file: path=~/src state=directory
  - name: sp src dir
    file: path=~/src/sp state=directory

  - name: computername
    set_fact:
      computername: ngn
  - name: set computername
    shell: scutil --set ComputerName {{ computername }}
    become: yes
    when: ansible_hostname != computername

  - name: set hostname
    shell: scutil --set HostName {{ computername }}
    become: yes
    when: ansible_hostname != computername

  - name: set localhostname
    shell: scutil --set LocalHostName {{ computername }}
    become: yes
    when: ansible_hostname != computername

  - name: set the netbios name
    become: yes
    osx_defaults:
       domain: com.apple.smb.server
       key: NetBIOSName
       type: string
       value: "{{ computername }}"
       state: present
